### CSRF Token (Cross-Site Request Forgery Token)

#### Definition
A CSRF token is a unique, secret, and unpredictable value that is generated by a server and included in an HTTP request to protect against Cross-Site Request Forgery (CSRF) attacks.

#### Characteristics
- **Uniqueness**: Each token is unique for a session or a particular request.
- **Secret**: Known only to the server and the client, not visible to third parties.
- **Unpredictable**: Difficult for an attacker to guess or forge.

#### How It Works
1. **Token Generation**: When a user initiates a session (e.g., logs in), the server generates a CSRF token and sends it to the client, typically as a hidden field in forms or as a header in AJAX requests.
2. **Token Inclusion**: The client includes this token in subsequent requests to the server that modify data (e.g., POST, PUT, DELETE requests).
3. **Token Validation**: The server checks the token in the incoming request against the token stored in the user's session. If they match, the request is considered legitimate.
4. **Rejection of Invalid Requests**: If the token is missing or does not match, the server rejects the request, thereby preventing the CSRF attack.

#### Real-Time Usage

##### Scenario 1: Web Form Submission
- **Description**: A user submits a form to update their profile information on a website.
- **Process**:
  1. The server includes a hidden CSRF token in the form when it's rendered.
  2. The user fills out the form and submits it.
  3. The submitted form includes the CSRF token.
  4. The server validates the CSRF token against the one stored in the session.
  5. If valid, the server processes the form submission; otherwise, it rejects the request.

##### Scenario 2: AJAX Request
- **Description**: A user updates their settings using an AJAX request.
- **Process**:
  1. When the page loads, the server sends the CSRF token to the client, either in a meta tag or as part of the initial page load.
  2. The client includes the CSRF token in the header of the AJAX request.
  3. The server validates the CSRF token.
  4. If valid, the server processes the request; otherwise, it rejects it.

##### Scenario 3: REST API
- **Description**: A web application interacts with a REST API to modify user data.
- **Process**:
  1. Upon authentication, the server provides the client with a CSRF token.
  2. The client includes the CSRF token in the headers of subsequent API requests.
  3. The server checks the CSRF token against the session.
  4. If the token is valid, the request proceeds; if not, the server returns an error response.

### Importance
- **Security**: Protects against CSRF attacks, where an attacker tricks a user into submitting malicious requests.
- **Integrity**: Ensures that state-changing requests (e.g., form submissions, AJAX requests) are made intentionally by the legitimate user.
- **Trust**: Maintains user trust by safeguarding their data and actions on the web application.

### EXAMPLE IMPLEMENTATION
 1.Step 1: Generate and Include CSRF Token in HTML Form

```
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.IOException;
import java.security.SecureRandom;
import java.math.BigInteger;

public class CSRFTokenServlet extends HttpServlet {
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        HttpSession session = request.getSession();
        SecureRandom random = new SecureRandom();
        String csrfToken = new BigInteger(130, random).toString(32);
        session.setAttribute("csrfToken", csrfToken);

        request.setAttribute("csrfToken", csrfToken);
        request.getRequestDispatcher("/form.jsp").forward(request, response);
    }
}
```
 2. HTML Form (form.jsp)
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Form with CSRF Token</title>
</head>
<body>
    <form id="dataForm" method="POST" action="/submit">
        <input type="hidden" id="csrfToken" name="csrfToken" value="${csrfToken}">
        <label for="data">Data:</label>
        <input type="text" id="data" name="data">
        <button type="submit">Submit</button>
    </form>
    <script>
        // Include the CSRF token in AJAX requests
        document.addEventListener("DOMContentLoaded", function() {
            const csrfToken = document.getElementById("csrfToken").value;
            const form = document.getElementById("dataForm");
            form.addEventListener("submit", function(event) {
                event.preventDefault();
                const data = new FormData(form);
                fetch('/submit', {
                    method: 'POST',
                    headers: {
                        'CSRF-Token': csrfToken
                    },
                    body: data
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            });
        });
    </script>
</body>
</html>
```
 3. Step 2: Validate CSRF Token in Java Servlet
```
import javax.servlet.*;
import javax.servlet.http.*;
import java.io.IOException;

public class SubmitServlet extends HttpServlet {
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        HttpSession session = request.getSession();
        String sessionCsrfToken = (String) session.getAttribute("csrfToken");
        String requestCsrfToken = request.getHeader("CSRF-Token");

        if (sessionCsrfToken == null || !sessionCsrfToken.equals(requestCsrfToken)) {
            response.setStatus(HttpServletResponse.SC_FORBIDDEN);
            response.getWriter().write("{\"message\": \"CSRF token validation failed\"}");
            return;
        }

        String data = request.getParameter("data");
        // Process the data...

        response.setContentType("application/json");
        response.getWriter().write("{\"message\": \"Data processed successfully\"}");
    }
}
```
